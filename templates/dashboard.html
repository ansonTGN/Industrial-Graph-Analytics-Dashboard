{% extends "base.html" %}

{% block content %}
<!-- NAVBAR -->
<nav class="navbar navbar-dark shadow-sm flex-shrink-0" style="background: linear-gradient(90deg, #1e293b 0%, #334155 100%); z-index: 1040;">
    <div class="container-fluid px-3">
        <!-- Botón Toggle para Móvil -->
        <button class="btn btn-outline-light border-0 d-lg-none me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu">
            <i class="fa-solid fa-bars fa-lg"></i>
        </button>

        <a class="navbar-brand d-flex align-items-center gap-2 me-auto" href="#">
            <i class="fa-solid fa-network-wired text-info"></i> 
            <div class="d-flex flex-column">
                <span class="lh-1 fw-bold font-monospace fs-6">NEO4J ANALYTICS</span>
                <span style="font-size: 0.6rem; opacity: 0.7; letter-spacing: 1px;">PETROCHEM SYSTEMS</span>
            </div>
        </a>

        <div class="d-none d-md-flex align-items-center bg-black bg-opacity-25 px-3 py-1 rounded-pill border border-secondary border-opacity-25 me-3">
            <span class="d-flex align-items-center text-light small fw-bold font-monospace">
                <i class="fa-solid fa-circle text-success me-2" style="font-size: 0.5rem; box-shadow: 0 0 8px #2ecc71;"></i>
                {{ db_host | default(value="Conectado") }}
            </span>
        </div>
        <a href="/" class="btn btn-danger btn-sm rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;" title="Salir">
            <i class="fa-solid fa-power-off"></i>
        </a>
    </div>
</nav>

<!-- LAYOUT PRINCIPAL -->
<div class="d-flex flex-grow-1 overflow-hidden position-relative">
    
    <!-- SIDEBAR (Offcanvas en móvil, Columna en Desktop) -->
    <div class="offcanvas-lg offcanvas-start bg-light border-end d-flex flex-column flex-shrink-0 shadow-sm" 
         tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel" 
         style="width: 350px; max-width: 85vw;">
        
        <div class="offcanvas-header border-bottom bg-white">
            <h6 class="offcanvas-title fw-bold text-uppercase text-secondary" id="sidebarMenuLabel">
                <i class="fa-solid fa-sliders me-2"></i>Panel de Control
            </h6>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" data-bs-target="#sidebarMenu" aria-label="Close"></button>
        </div>
        
        <div class="offcanvas-body p-0 d-flex flex-column flex-grow-1 overflow-hidden bg-light">
            <div class="flex-grow-1 overflow-auto p-3">
                <form action="/query" method="post" id="queryForm">
                    <!-- Selector de Objetivo -->
                    <div class="mb-3 bg-white p-3 rounded shadow-sm border">
                        <label class="form-label fw-bold small text-dark d-flex justify-content-between align-items-center">
                            OBJETO OBJETIVO 
                            <span class="badge bg-info text-dark" id="target-badge" style="display:none;">¡Set!</span>
                        </label>
                        <select id="select-param" name="param" autocomplete="off" placeholder="Buscar ID o Nombre...">
                            {% if current_param %}
                                <option value="{{ current_param }}" selected>{{ current_param_label }}</option>
                            {% endif %}
                        </select>
                        <div class="form-text small mt-1 text-muted fst-italic" style="font-size: 0.7rem;">
                            <i class="fa-solid fa-circle-info me-1"></i>Selecciona un nodo del grafo o tabla.
                        </div>
                    </div>

                    <!-- Acordeón de Consultas -->
                    <label class="form-label fw-bold small text-dark mb-2 px-1">BIBLIOTECA DE CONSULTAS</label>
                    <div class="accordion accordion-flush shadow-sm rounded border overflow-hidden" id="queriesAccordion">
                        {% for category, queries in categorized_queries %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading{{ loop.index }}">
                                <button class="accordion-button collapsed fw-bold py-2 bg-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ loop.index }}" style="font-size: 0.85rem; color: #34495e;">
                                    <i class="fa-solid fa-folder me-2 text-primary opacity-50"></i> {{ category }}
                                    <span class="badge bg-secondary bg-opacity-10 text-secondary ms-auto rounded-pill" style="font-size: 0.65rem;">{{ queries | length }}</span>
                                </button>
                            </h2>
                            <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" data-bs-parent="#queriesAccordion">
                                <div class="accordion-body p-0">
                                    <div class="list-group list-group-flush">
                                        {% for q in queries %}
                                        <label class="list-group-item list-group-item-action d-flex align-items-center gap-2 border-0 py-2 ps-4" style="font-size: 0.8rem; cursor: pointer;">
                                            <input class="form-check-input flex-shrink-0" type="radio" name="query_id" value="{{ q.id }}" {% if current_query == q.id %}checked{% endif %} required>
                                            <div class="w-100 lh-sm" title="{{ q.description }}">
                                                <i class="fa-solid {{ q.icon }} me-1 opacity-50 text-center" style="width: 15px;"></i> {{ q.title }}
                                            </div>
                                        </label>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </form>
            </div>
            
            <!-- Footer fijo del Sidebar -->
            <div class="p-3 border-top bg-white flex-shrink-0">
                <button type="submit" form="queryForm" class="btn btn-primary w-100 fw-bold shadow-sm py-2">
                    <i class="fa-solid fa-bolt me-2"></i> EJECUTAR
                </button>
                {% if error %}
                <div class="alert alert-danger mt-2 mb-0 py-1 px-2 small shadow-sm border-0 text-center lh-sm">{{ error }}</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- CONTENIDO PRINCIPAL -->
    <div class="flex-grow-1 d-flex flex-column min-w-0 bg-white position-relative">
        {% if results %}
        <!-- Header Resultados -->
        <div class="bg-white px-3 py-2 border-bottom d-flex justify-content-between align-items-center shadow-sm z-2">
            <div class="overflow-hidden me-2">
                <h6 class="mb-0 fw-bold text-primary text-truncate">{{ results.query_title }}</h6>
                <div class="text-muted text-truncate" style="font-size: 0.7rem;">
                    <i class="fa-regular fa-clock me-1"></i>{{ results.timestamp }} 
                    <span class="d-none d-sm-inline">| <i class="fa-solid fa-table-list me-1"></i>{{ results.rows | length }} filas</span>
                </div>
            </div>
            <div class="btn-group btn-group-sm flex-shrink-0">
                <button class="btn btn-outline-secondary" onclick="downloadGraphPNG()" title="Captura"><i class="fa-solid fa-camera"></i></button>
                <button class="btn btn-outline-secondary" onclick="exportCSV()" title="CSV"><i class="fa-solid fa-file-csv"></i></button>
            </div>
        </div>

        <!-- Tabs y Vistas -->
        <div class="d-flex flex-column flex-grow-1 overflow-hidden position-relative">
            <!-- Tabs Navigation -->
            <ul class="nav nav-tabs nav-fill bg-light border-bottom flex-shrink-0" id="resultTabs" role="tablist">
                <li class="nav-item"><button class="nav-link py-2 {% if results.is_graph %}active{% endif %} small" data-bs-toggle="tab" data-bs-target="#graph-pane"><i class="fa-solid fa-circle-nodes"></i> Grafo</button></li>
                <li class="nav-item"><button class="nav-link py-2 {% if not results.is_graph %}active{% endif %} small" data-bs-toggle="tab" data-bs-target="#table-pane"><i class="fa-solid fa-table"></i> Tabla</button></li>
                <li class="nav-item"><button class="nav-link py-2 small" data-bs-toggle="tab" data-bs-target="#chart-pane"><i class="fa-solid fa-chart-pie"></i> Stats</button></li>
            </ul>

            <div class="tab-content flex-grow-1 position-relative overflow-hidden">
                <!-- PANE GRAFO -->
                <div class="tab-pane fade {% if results.is_graph %}show active{% endif %} h-100 w-100 position-relative" id="graph-pane">
                    <div id="network-container"></div> <!-- CSS Absolute 100% -->
                    
                    <!-- Controles Zoom Flotantes -->
                    <div class="position-absolute bottom-0 start-0 m-2 btn-group-vertical shadow opacity-75">
                        <button class="btn btn-light btn-sm p-1" onclick="network.moveTo({scale: 1.5})"><i class="fa-solid fa-plus"></i></button>
                        <button class="btn btn-light btn-sm p-1" onclick="network.fit()"><i class="fa-solid fa-compress"></i></button>
                        <button class="btn btn-light btn-sm p-1" onclick="network.moveTo({scale: 0.5})"><i class="fa-solid fa-minus"></i></button>
                    </div>
                </div>

                <!-- PANE TABLA -->
                <div class="tab-pane fade {% if not results.is_graph %}show active{% endif %} h-100 overflow-auto bg-white" id="table-pane">
                    <div class="table-responsive h-100">
                        <table class="table table-hover table-striped table-sm mb-0 align-middle small table-bordered border-top-0">
                            <thead class="table-dark sticky-top shadow-sm">
                                <tr>
                                    <th class="text-center bg-secondary" style="width: 40px;">#</th>
                                    {% for col in results.columns %}
                                    <th class="text-nowrap px-2 py-2">{{ col }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in results.rows %}
                                <tr>
                                    <td class="text-center text-muted bg-light">{{ loop.index }}</td>
                                    {% for col in results.columns %}
                                    <td class="px-2 py-1 text-nowrap" style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">
                                        {% if "ID" in col or "EQUIPO" == col or "MATERIAL" == col %}
                                            {% if row[col] != "-" and "Lista" not in row[col] %}
                                            <a href="#" class="text-decoration-none fw-bold text-dark d-flex align-items-center justify-content-between"
                                               onclick="updateSearchParam('{{ row[col] }}', '{{ row[col] }}'); return false;">
                                                <span>{{ row[col] }}</span>
                                                <i class="fa-solid fa-crosshairs text-primary opacity-50 ms-1" style="font-size: 0.7rem;"></i>
                                            </a>
                                            {% else %}
                                                {{ row[col] }}
                                            {% endif %}
                                        {% else %}
                                            {{ row[col] }}
                                        {% endif %}
                                    </td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- PANE CHART -->
                <div class="tab-pane fade h-100 w-100 p-2 overflow-hidden bg-white" id="chart-pane">
                    <div class="d-flex flex-column h-100 w-100">
                        <h6 class="text-center text-secondary small text-uppercase fw-bold my-2" id="chart-title">Estadísticas</h6>
                        <div class="flex-grow-1 position-relative w-100" style="min-height: 0;">
                            <canvas id="mainChart"></canvas>
                        </div>
                        <p class="text-center text-muted small mt-1 fst-italic" style="font-size: 0.7rem;" id="chart-msg"></p>
                    </div>
                </div>
            </div>
        </div>

        {% else %}
        <!-- Estado Vacío -->
        <div class="d-flex flex-column justify-content-center align-items-center h-100 text-center p-4 bg-light">
            <div class="bg-white p-4 rounded-circle shadow-sm mb-3">
                <i class="fa-solid fa-magnifying-glass-chart fa-3x text-primary opacity-50"></i>
            </div>
            <h5 class="fw-bold text-dark">Bienvenido</h5>
            <p class="text-muted small">Abre el menú lateral para ejecutar una consulta.</p>
            <button class="btn btn-primary btn-sm d-lg-none mt-2 pulse-animation" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
                <i class="fa-solid fa-arrow-right me-2"></i>Abrir Menú
            </button>
        </div>
        {% endif %}

        <!-- Botón Flotante (FAB) para reabrir menú en móvil si hay resultados -->
        {% if results %}
        <button class="btn btn-primary rounded-circle shadow-lg d-lg-none position-fixed bottom-0 end-0 m-3 d-flex align-items-center justify-content-center" 
                style="width: 50px; height: 50px; z-index: 1030;" 
                data-bs-toggle="offcanvas" data-bs-target="#sidebarMenu">
            <i class="fa-solid fa-bars"></i>
        </button>
        {% endif %}
    </div>
</div>

<!-- OFF CANVAS DETALLE NODO (Panel Derecha) -->
<div class="offcanvas offcanvas-end shadow border-start" tabindex="-1" id="nodeOffcanvas" data-bs-backdrop="false" style="max-width: 90vw;">
    <div class="offcanvas-header bg-primary text-white py-2">
        <h6 class="offcanvas-title fw-bold"><i class="fa-solid fa-circle-info me-2"></i>Detalle</h6>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        <div class="text-center mb-3">
            <div class="badge bg-light text-primary border p-2 mb-2 rounded-circle"><i class="fa-solid fa-cube fa-2x"></i></div>
            <h5 id="canvasNodeLabel" class="fw-bold text-break lh-sm"></h5>
            <span id="canvasNodeType" class="badge bg-secondary"></span>
        </div>
        
        <div class="card bg-light border-0 mb-3">
            <div class="card-body p-2 text-center">
                <small class="text-muted fw-bold text-uppercase d-block mb-1">ID del Nodo</small>
                <code id="canvasNodeId" class="fs-6 fw-bold text-dark"></code>
            </div>
        </div>

        <div class="d-grid gap-2">
            <button class="btn btn-primary fw-bold btn-sm py-2" onclick="setFocusFromCanvas()">
                <i class="fa-solid fa-crosshairs me-2"></i> Usar como Filtro
            </button>
            <button class="btn btn-outline-dark btn-sm py-2" data-bs-dismiss="offcanvas">
                Cerrar
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // --- VARIABLES GLOBALES ---
    let tomSelectInstance;
    let network = null;
    let nodesDataSet, edgesDataSet;
    let selectedNodeData = null; 

    // --- INICIALIZACIÓN ---
    document.addEventListener("DOMContentLoaded", function(){
        // Configurar TomSelect
        tomSelectInstance = new TomSelect("#select-param", {
            valueField: 'id', 
            labelField: 'title', 
            searchField: ['title', 'id'], 
            preload: 'focus',
            placeholder: 'Escribe para buscar...',
            load: function(query, callback) {
                const url = '/api/search?q=' + encodeURIComponent(query || '');
                fetch(url).then(r => r.json()).then(json => callback(json)).catch(() => callback());
            },
            render: {
                option: function(item, escape) {
                    return `<div class="py-2 d-flex align-items-center border-bottom">
                                <div class="me-2"><span class="badge bg-secondary">${escape(item.label)}</span></div>
                                <div class="text-truncate" style="max-width: 180px;">${escape(item.title)}</div>
                            </div>`;
                }
            }
        });
        
        // Expandir acordeón activo y hacer scroll
        {% if current_query %}
            const activeRadio = document.querySelector('input[name="query_id"][value="{{ current_query }}"]');
            if(activeRadio) {
                const collapseDiv = activeRadio.closest('.accordion-collapse');
                if(collapseDiv) {
                    new bootstrap.Collapse(collapseDiv, { toggle: true });
                    setTimeout(() => activeRadio.scrollIntoView({block: "center"}), 300);
                }
            }
        {% endif %}
    });

    // --- LÓGICA DE ACTUALIZACIÓN DEL BUSCADOR ---
    function updateSearchParam(id, label) {
        if(tomSelectInstance) {
            tomSelectInstance.addOption({id: id, title: label, label: 'Selección Manual'});
            tomSelectInstance.setValue(id);
            const badge = document.getElementById('target-badge');
            badge.style.display = 'inline-block';
            setTimeout(() => badge.style.display = 'none', 2000);
            
            // Cerrar offcanvas detalle si está abierto
            const offEl = document.getElementById('nodeOffcanvas');
            const bsOff = bootstrap.Offcanvas.getInstance(offEl);
            if (bsOff) bsOff.hide();

            // En móvil, abrir el menú lateral para mostrar que se seleccionó
            if(window.innerWidth < 992) {
               const menuEl = document.getElementById('sidebarMenu');
               const bsMenu = bootstrap.Offcanvas.getOrCreateInstance(menuEl);
               bsMenu.show();
            }
        }
    }

    function setFocusFromCanvas() {
        if (selectedNodeData) {
            updateSearchParam(selectedNodeData.id, selectedNodeData.label);
        }
    }

    // --- LÓGICA DE RESULTADOS ---
    {% if results %}
        const rows = {{ results.rows | json_encode() | safe }};
        const cols = {{ results.columns | json_encode() | safe }};
        const isGraphQuery = {{ results.is_graph | json_encode() }};
        
        const hasGraphData = cols.includes('A_ID') && cols.includes('B_ID');

        // 1. INICIAR VISTA GRAFO
        if (hasGraphData && isGraphQuery) {
            initGraph(rows);
        } else if (hasGraphData) {
            document.getElementById('network-container').innerHTML = 
                '<div class="d-flex h-100 align-items-center justify-content-center text-muted flex-column"><i class="fa-solid fa-table fa-2x mb-2"></i><span>Vista tabular preferida.</span></div>';
        } else {
            document.getElementById('network-container').innerHTML = 
                '<div class="d-flex h-100 align-items-center justify-content-center text-muted flex-column"><i class="fa-solid fa-ban fa-2x mb-2"></i><span>Datos no representables en grafo.</span></div>';
        }

        // 2. CHART JS CONFIG
        const numericKeywords = ['CANTIDAD', 'TOTAL', 'SCORE', 'VECES', 'PRECIO', 'STOCK', 'NUM', 'CONEXIONES', 'RIESGO', 'LONGITUD', 'DENSIDAD', 'PORCENTAJE', 'MEDIA', 'PROMEDIO', 'OBSOLETOS'];
        const numericCol = cols.find(c => numericKeywords.some(k => c.toUpperCase().includes(k)));
        const labelKeywords = ['DESCRIPCION', 'NAME', 'NOMBRE', 'EQUIPO', 'MATERIAL', 'A_LABEL', 'PLANTA', 'TAG'];
        const labelCol = cols.find(c => labelKeywords.some(k => c.toUpperCase().includes(k))) || cols[0];

        if (numericCol && rows.length > 0) {
            document.getElementById('chart-title').innerText = `${numericCol} por ${labelCol}`;
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            // Top 30 para no saturar móvil
            const topRows = rows.slice(0, 30);
            
            const labels = topRows.map(r => (r[labelCol] || '').substring(0, 15) + (r[labelCol]?.length>15?'...':''));
            const dataValues = topRows.map(r => {
                let val = r[numericCol];
                if (typeof val === 'string') val = val.replace(/[^0-9.-]+/g,"");
                return parseFloat(val) || 0;
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{ 
                        label: numericCol, 
                        data: dataValues, 
                        backgroundColor: '#3498db',
                        borderRadius: 3
                    }]
                }, 
                options: { 
                    responsive: true,
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { font: { size: 10 }, maxRotation: 90, minRotation: 90 } } // Rotar etiquetas en móvil
                    }
                }
            });
        } else {
            document.getElementById('chart-msg').innerHTML = `No se encontraron datos numéricos para graficar.`;
        }

        // --- FUNCIÓN PARA INICIALIZAR VIS.JS ---
        function initGraph(data) {
            const container = document.getElementById('network-container');
            const nodesMap = new Map();
            const edgesArr = [];
            
            // Limitar nodos en móvil para rendimiento
            const isMobile = window.innerWidth < 768;
            const maxNodes = isMobile ? 150 : 1000;
            let processedCount = 0;

            data.forEach((row) => {
                if(processedCount > maxNodes) return;

                if (row.A_ID && !nodesMap.has(row.A_ID)) {
                    nodesMap.set(row.A_ID, {
                        id: row.A_ID, 
                        label: isMobile ? (row.A_LABEL || row.A_ID).substring(0,8)+".." : formatLabel(row.A_LABEL), 
                        fullLabel: row.A_LABEL,
                        group: row.A_TYPE,
                        value: 1
                    });
                    processedCount++;
                }
                if (row.B_ID && !nodesMap.has(row.B_ID)) {
                    nodesMap.set(row.B_ID, {
                        id: row.B_ID, 
                        label: isMobile ? (row.B_LABEL || row.B_ID).substring(0,8)+".." : formatLabel(row.B_LABEL), 
                        fullLabel: row.B_LABEL,
                        group: row.B_TYPE,
                        value: 1
                    });
                    processedCount++;
                }
                if (row.A_ID && row.B_ID) {
                    edgesArr.push({
                        from: row.A_ID, 
                        to: row.B_ID, 
                        label: row.RELACION || '', 
                        arrows: 'to',
                        color: { color: '#bdc3c7' },
                        font: { align: 'middle', size: isMobile ? 8 : 10 }
                    });
                }
            });

            nodesDataSet = new vis.DataSet(Array.from(nodesMap.values()));
            edgesDataSet = new vis.DataSet(edgesArr);

            const options = {
                nodes: { 
                    shape: 'dot', 
                    scaling: { min: 10, max: 25 },
                    font: { size: isMobile ? 12 : 14, face: 'Outfit', color: '#333' },
                    borderWidth: 1,
                    shadow: true
                }, 
                edges: { width: 1, smooth: { type: 'continuous' } },
                groups: { 
                    Material: { color: { background:'#f1c40f', border:'#f39c12'} }, 
                    Equipo:   { color: { background:'#3498db', border:'#2980b9'} }, 
                    UbicacionTecnica: { color: { background:'#2ecc71', border:'#27ae60'} },
                    Repuesto: { color: { background:'#e67e22', border:'#d35400'} },
                    Obsoleto: { color: { background:'#e74c3c', border:'#c0392b'}, shape: 'triangle' }
                },
                physics: {
                    stabilization: true,
                    barnesHut: { 
                        gravitationalConstant: isMobile ? -2000 : -4000, 
                        springLength: isMobile ? 150 : 250
                    }
                },
                interaction: { hover: true, tooltipDelay: 200, zoomView: true }
            };

            network = new vis.Network(container, { nodes: nodesDataSet, edges: edgesDataSet }, options);

            network.on("click", function (params) {
                if (params.nodes.length > 0) {
                    const nodeId = params.nodes[0];
                    const node = nodesDataSet.get(nodeId);
                    
                    selectedNodeData = { id: node.id, label: node.fullLabel };
                    document.getElementById('canvasNodeLabel').innerText = node.fullLabel;
                    document.getElementById('canvasNodeType').innerText = node.group;
                    document.getElementById('canvasNodeId').innerText = node.id;

                    const bsOffcanvas = new bootstrap.Offcanvas(document.getElementById('nodeOffcanvas'));
                    bsOffcanvas.show();
                }
            });
        }

        function formatLabel(text) {
            if(!text) return "";
            return text.length > 20 ? text.substring(0, 18) + "..." : text;
        }

        function downloadGraphPNG() { 
            network.fit({animation:false}); 
            setTimeout(() => { 
                let a = document.createElement('a'); 
                a.download = 'grafo.png'; 
                a.href = document.getElementById('network-container').getElementsByTagName('canvas')[0].toDataURL(); 
                a.click(); 
            }, 500); 
        }

        function exportCSV() {
            let csv = cols.join(",") + "\n"; 
            rows.forEach(r => csv += cols.map(c => `"${(r[c]||'').toString().replace(/"/g,'""')}"`).join(",") + "\n");
            let a = document.createElement('a'); 
            a.href = window.URL.createObjectURL(new Blob([csv], {type: 'text/csv'})); 
            a.download = 'datos.csv'; 
            a.click();
        }
    {% endif %}
</script>
<style>
    /* Animación para guiar al usuario en móvil */
    @keyframes pulse-btn {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(13, 110, 253, 0.7); }
        70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(13, 110, 253, 0); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(13, 110, 253, 0); }
    }
    .pulse-animation { animation: pulse-btn 2s infinite; }
</style>
{% endblock %}
